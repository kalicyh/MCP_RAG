# ä¸ªäºº RAG æœåŠ¡å™¨ï¼ˆåŸºäº MCPï¼‰

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå…¼å®¹æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼ŒModel Context Protocolï¼‰çš„æœåŠ¡å™¨ï¼Œèµ‹èƒ½ AI å®¢æˆ·ç«¯ï¼ˆå¦‚ Cursorã€Claude for Desktop ç­‰ï¼‰å…·å¤‡å¢å¼ºæ£€ç´¢ç”Ÿæˆï¼ˆRAGï¼ŒRetrieval-Augmented Generationï¼‰èƒ½åŠ›ã€‚å…è®¸è¯­è¨€æ¨¡å‹è®¿é—®åŸºäºä½ è‡ªå·±æ–‡æœ¬å’Œæ–‡æ¡£çš„æœ¬åœ°ç§æœ‰çŸ¥è¯†åº“ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- **ä¸ºä½ çš„ AI æä¾›æŒä¹…è®°å¿†**ï¼šè®© AI å­¦ä¹ æ–°ä¿¡æ¯ï¼Œå¹¶èƒ½è·¨ä¼šè¯è®°å¿†ã€‚
- **ğŸ†• å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰**ï¼šç›´è§‚çš„æ¡Œé¢åº”ç”¨ï¼Œå¸¦æœ‰ç»“æ„åŒ–è„šæœ¬ï¼Œæ–¹ä¾¿å®‰è£…ä¸è¿è¡Œã€‚
- **ğŸš€ é«˜çº§æ–‡æ¡£å¤„ç†**ï¼šæ”¯æŒè¶…è¿‡ 25 ç§æ ¼å¼æ–‡ä»¶ï¼ŒåŒ…æ‹¬ PDFã€DOCXã€PPTXã€XLSXã€å›¾ç‰‡ï¼ˆå« OCRï¼‰ã€é‚®ä»¶ç­‰ã€‚
- **ğŸ§  æ™ºèƒ½å¤„ç†å¼•æ“ Unstructured**ï¼šä¼ä¸šçº§æ–‡æ¡£å¤„ç†ï¼Œä¿æŒè¯­ä¹‰ç»“æ„ï¼Œè‡ªåŠ¨å»å™ªï¼Œæ”¯æŒå¤æ‚æ ¼å¼ã€‚
- **ğŸ”„ å¯é å›é€€æœºåˆ¶**ï¼šå¤šé‡å¤„ç†ç­–ç•¥ç¡®ä¿æ‰€æœ‰æ–‡æ¡£å‡èƒ½æˆåŠŸå¤„ç†ã€‚
- **ğŸ“Š ç»“æ„åŒ–å…ƒæ•°æ®**ï¼šè¯¦ç»†æ–‡æ¡£ç»“æ„ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€è¡¨æ ¼ã€åˆ—è¡¨ï¼‰ï¼Œæ–¹ä¾¿è¿½è¸ªã€‚
- **ğŸ” é«˜çº§æœç´¢è¿‡æ»¤**ï¼šåŸºäºå…ƒæ•°æ®çš„ç²¾å‡†è¿‡æ»¤ï¼Œæé«˜æœç´¢ç›¸å…³æ€§ã€‚
- **ğŸ“ˆ çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯**ï¼šè¯¦å°½å†…å®¹ä¸ç»“æ„åˆ†æã€‚
- **æœ¬åœ°ç§æœ‰å¤§è¯­è¨€æ¨¡å‹**ï¼šé€šè¿‡ [Ollama](https://ollama.com/) ä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼ˆå¦‚ Llama 3ã€Mistralï¼‰ï¼Œä¿è¯æ•°æ®å’Œæé—®ä¸å‡ºæœ¬æœºã€‚
- **100% æœ¬åœ°ç¦»çº¿è¿è¡Œ**ï¼šè¯­è¨€æ¨¡å‹å’Œå‘é‡åµŒå…¥å‡æœ¬åœ°æ‰§è¡Œï¼Œæ•°æ®ä¸è”ç½‘ï¼Œæ¨¡å‹ä¸‹è½½å®Œæˆåæ— éœ€ç½‘ç»œã€‚
- **æ‰¹é‡å¯¼å…¥æ”¯æŒ**ï¼šä¸“ç”¨è„šæœ¬æ‰¹é‡å¤„ç†æ–‡æ¡£ç›®å½•ï¼Œé«˜æ•ˆæ„å»ºçŸ¥è¯†åº“ã€‚
- **æ¨¡å—åŒ–æ¶æ„**ï¼šRAG é€»è¾‘ä¸æœåŠ¡å™¨ã€å¯¼å…¥è„šæœ¬åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚
- **Markdown å¤‡ä»½**ï¼šè‡ªåŠ¨ä¿å­˜å¤„ç†åçš„æ¯ä¸ªæ–‡æ¡£ä¸º Markdown æ ¼å¼ï¼Œä¾¿äºéªŒè¯å’Œå¤ç”¨ã€‚
- **ğŸ†• æ¥æºå…ƒæ•°æ®**ï¼šå®Œæ•´çš„ä¿¡æ¯æº¯æºï¼Œå›ç­”é™„å¸¦æ¥æºå½’å±ã€‚
- **ğŸ†• AI ä»£ç†ä¼˜åŒ–**ï¼šè¯¦å°½æè¿°å’Œæ™ºèƒ½é”™è¯¯å¤„ç†ï¼Œæå‡ä»£ç†ä½¿ç”¨æ•ˆç‡ã€‚
- **ğŸ†• ç»“æ„åŒ–è„šæœ¬ä½“ç³»**ï¼šæ¨¡å—åŒ–è„šæœ¬åˆ’åˆ†å®‰è£…ã€è¿è¡Œå’Œè¯Šæ–­æµç¨‹ã€‚


---

## ğŸ—ï¸ Arquitectura

è¯¥é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–ç»“æ„ï¼Œå°† MCP æœåŠ¡å™¨ç»„ä»¶ä¸å›¾å½¢ç”¨æˆ·ç•Œé¢ (GUI) æ¸…æ™°åœ°åˆ†ç¦»ã€‚è¿™ç§ç»„ç»‡æ–¹å¼æœ‰åˆ©äºæ¯ä¸ªç»„ä»¶çš„ç‹¬ç«‹ç»´æŠ¤ã€å¼€å‘å’Œä½¿ç”¨ã€‚

### é¡¹ç›®ç»“æ„

```
MCP_RAG/
â”œâ”€â”€ ğŸ“ mcp_server_organized/          # Servidor MCP principal
â”‚   â”œâ”€â”€ ğŸ“„ server.py                  # Servidor MCP con herramientas RAG
â”‚   â”œâ”€â”€ ğŸ“„ run_server_organized.bat   # Script para ejecutar el servidor
â”‚   â”œâ”€â”€ ğŸ“ src/                       # CÃ³digo fuente del servidor
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ rag_core.py            # LÃ³gica principal del RAG
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ rag_server_bk.py       # Servidor MCP (backup)
â”‚   â”‚   â”œâ”€â”€ ğŸ“ models/                # Modelos de datos
â”‚   â”‚   â”œâ”€â”€ ğŸ“ services/              # Servicios del servidor
â”‚   â”‚   â”œâ”€â”€ ğŸ“ tools/                 # Herramientas MCP
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/                 # Utilidades
â”‚   â”œâ”€â”€ ğŸ“ tests/                     # Pruebas del servidor
â”‚   â”œâ”€â”€ ğŸ“ data/                      # Datos del servidor
â”‚   â”‚   â”œâ”€â”€ ğŸ“ documents/             # Documentos procesados
â”‚   â”‚   â””â”€â”€ ğŸ“ vector_store/          # Base de datos vectorial
â”‚   â””â”€â”€ ğŸ“ embedding_cache/           # Cache de embeddings
â”‚
â”œâ”€â”€ ğŸ“ bulk_ingest_GUI/               # Interfaz grÃ¡fica de usuario
â”‚   â”œâ”€â”€ ğŸ“„ main.py                    # Punto de entrada principal
â”‚   â”œâ”€â”€ ğŸ“„ launch.py                  # Lanzador de la aplicaciÃ³n
â”‚   â”œâ”€â”€ ğŸ“„ start_app.py               # InicializaciÃ³n de la app
â”‚   â”œâ”€â”€ ğŸ“„ rag_core_wrapper.py        # Wrapper para rag_core
â”‚   â”œâ”€â”€ ğŸ“ views/                     # Vistas de la interfaz
â”‚   â”‚   â””â”€â”€ ğŸ“„ main_view.py           # Vista principal
â”‚   â”œâ”€â”€ ğŸ“ controllers/               # Controladores
â”‚   â”‚   â””â”€â”€ ğŸ“„ main_controller.py     # Controlador principal
â”‚   â”œâ”€â”€ ğŸ“ services/                  # Servicios de la GUI
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ document_service.py    # Servicio de documentos
â”‚   â”‚   â””â”€â”€ ğŸ“„ configuration_service.py # Servicio de configuraciÃ³n
â”‚   â”œâ”€â”€ ğŸ“ models/                    # Modelos de la GUI
â”‚   â”œâ”€â”€ ğŸ“ widgets/                   # Widgets personalizados
â”‚   â”œâ”€â”€ ğŸ“ gui_utils/                 # Utilidades de la GUI
â”‚   â”œâ”€â”€ ğŸ“ data/                      # Datos de la GUI
â”‚   â”‚   â”œâ”€â”€ ğŸ“ documents/             # Documentos procesados
â”‚   â”‚   â””â”€â”€ ğŸ“ vector_store/          # Base de datos vectorial
â”‚   â””â”€â”€ ğŸ“ embedding_cache/           # Cache de embeddings
â”‚
â”œâ”€â”€ ğŸ“„ start.bat                      # Script principal de arranque
â”œâ”€â”€ ğŸ“„ run_gui.bat                    # Script para ejecutar la GUI
â”œâ”€â”€ ğŸ“„ install_requirements.bat       # InstalaciÃ³n de dependencias
â”œâ”€â”€ ğŸ“„ requirements.txt               # Dependencias del proyecto
â”œâ”€â”€ ğŸ“„ README.md                      # DocumentaciÃ³n principal
â”œâ”€â”€ ğŸ“„ SCRIPTS_README.md              # GuÃ­a de scripts
â”œâ”€â”€ ğŸ“„ GUI_ADVANCED_README.md         # GuÃ­a de la GUI para ingesta de documentos masivo
â””â”€â”€ ğŸ“„ AGENT_INSTRUCTIONS.md          # Instrucciones para agentes IA
```

### ä¸»è¦ç»„ä»¶

#### 1ï¼‰MCP æœåŠ¡å™¨ï¼ˆ`mcp_server_organized/`ï¼‰
- `server.py`ï¼šå¯¹å¤–æš´éœ² RAG å·¥å…·çš„ MCP ä¸»æœåŠ¡å™¨
- `src/rag_core.py`ï¼šRAG çš„æ ¸å¿ƒï¼ŒåŒ…å«å…¨éƒ¨å¤„ç†é€»è¾‘
- `src/tools/`ï¼šMCP å·¥å…·ï¼ˆ`learn_text`ã€`learn_document`ã€`ask_rag` ç­‰ï¼‰
- `src/services/`ï¼šæœåŠ¡å™¨ç«¯æœåŠ¡ï¼ˆé…ç½®ã€æ—¥å¿—ç­‰ï¼‰
- `src/models/`ï¼šæ•°æ®æ¨¡å‹
- `src/utils/`ï¼šé€šç”¨å·¥å…·æ–¹æ³•

#### 2ï¼‰å›¾å½¢ç•Œé¢ï¼ˆ`bulk_ingest_GUI/`ï¼‰
- `main.py`ï¼šGUI åº”ç”¨ä¸»å…¥å£
- `views/main_view.py`ï¼šå¤šæ ‡ç­¾çš„ä¸»ç•Œé¢
- `controllers/main_controller.py`ï¼šç•Œé¢æ§åˆ¶é€»è¾‘
- `services/document_service.py`ï¼šæ–‡æ¡£å¤„ç†æœåŠ¡
- `services/configuration_service.py`ï¼šé…ç½®ç®¡ç†
- `widgets/`ï¼šè‡ªå®šä¹‰æ§ä»¶
- `gui_utils/`ï¼šGUI å®ç”¨å·¥å…·

#### 3ï¼‰ç³»ç»Ÿè„šæœ¬
- `start.bat`ï¼šå¼•å¯¼ç”¨æˆ·çš„å¯åŠ¨è„šæœ¬
- `run_gui.bat`ï¼šç›´æ¥å¯åŠ¨ GUI åº”ç”¨
- `install_requirements.bat`ï¼šå®Œæ•´ä¾èµ–å®‰è£…
- `check_system.bat`ï¼šç³»ç»Ÿè¯Šæ–­
- `fix_dependencies.bat`ï¼šä¾èµ–ä¿®å¤

### æ•°æ®æµ

1. **æ–‡æ¡£æå–**ï¼šGUI ä½¿ç”¨ `rag_core_wrapper.py` å¤„ç†æ–‡æ¡£
2. **å­˜å‚¨**ï¼šæ–‡æ¡£å­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ä¸­
3. **æŸ¥è¯¢**ï¼šMCP æœåŠ¡å™¨è®¿é—®åŒä¸€æ•°æ®åº“ä»¥å›ç­”æŸ¥è¯¢
4. **å“åº”**ï¼šMCP å·¥å…·è¿”å›åŒ…å«æºçš„å“åº”

### **èŒè´£åˆ†ç¦»**

- **MCP æœåŠ¡å™¨**ï¼šä¸“æ³¨äºå‘ AI å®¢æˆ·ç«¯å…¬å¼€å·¥å…·
- **GUI**ï¼šä¸“æ³¨äºæ–‡æ¡£æå–çš„ç”¨æˆ·ä½“éªŒ
- **RAG æ ¸å¿ƒ**ï¼šä¸¤ä¸ªç»„ä»¶ä¹‹é—´å…±äº«é€»è¾‘
- **è„šæœ¬**ï¼šè‡ªåŠ¨åŒ–å’Œç¯å¢ƒç®¡ç†

è¿™ç§æ¨¡å—åŒ–æ¶æ„å…è®¸ï¼š
- âœ… å„ä¸ªç»„ä»¶ç‹¬ç«‹å¼€å‘
- âœ… æœåŠ¡å™¨å’Œ GUI ä¹‹é—´çš„ä»£ç å¤ç”¨
- âœ… æ˜“äºç»´æŠ¤å’Œè°ƒè¯•
- âœ… æ–°åŠŸèƒ½çš„å¯æ‰©å±•æ€§
- âœ… ç‹¬ç«‹ä½¿ç”¨æœåŠ¡å™¨æˆ– GUI

### æ–‡æ¡£æ¸…å•
- [`AGENT_INSTRUCTIONS.md`](./AGENT_INSTRUCTIONS.md)ï¼šé¢å‘æ™ºèƒ½ä½“çš„å®Œæ•´ä½¿ç”¨æŒ‡å—
- [`GUI_ADVANCED_README.md`](./GUI_ADVANCED_README.md)ï¼šæ‰¹é‡å¯¼å…¥ GUI ä½¿ç”¨æŒ‡å—
- [`SCRIPTS_README.md`](./SCRIPTS_README.md)ï¼šè„šæœ¬ä½“ç³»è¯´æ˜
- [`STORAGE_PROGRESS_README.md`](./STORAGE_PROGRESS_README.md)ï¼šå­˜å‚¨è¿›åº¦ç³»ç»Ÿæ–‡æ¡£
- `test_enhanced_rag.py`ï¼šç³»ç»ŸéªŒè¯è„šæœ¬

---

## ğŸš€ å®‰è£…å’Œé…ç½®æŒ‡å—

è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¯åŠ¨å¹¶è¿è¡Œç³»ç»Ÿã€‚

### å…ˆå†³æ¡ä»¶

- **Python 3.10 åŠä»¥ä¸Šç‰ˆæœ¬**
- **Ollama**ï¼šç¡®ä¿ [Ollama å·²å®‰è£…](https://ollama.com/) å¹¶æ­£åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚
- **Tesseract OCRï¼ˆå¯é€‰ï¼‰ï¼š**ç”¨äºå¤„ç†å¸¦æœ‰æ–‡æœ¬çš„å›¾åƒã€‚è¯·ä» [GitHub](https://github.com/UB-Mannheim/tesseract/wiki) ä¸‹è½½æˆ–ä½¿ç”¨ `choco install tesseract`ã€‚

### 1. å®‰è£…ï¼ˆè‡ªåŠ¨ï¼ï¼‰

å¾—ç›Šäºäº•ç„¶æœ‰åºçš„è„šæœ¬ç³»ç»Ÿï¼Œå®‰è£…è¿‡ç¨‹æå…¶ç®€å•ã€‚

#### **å¯¹äºç”¨æˆ·ï¼ˆæ¨èï¼‰ï¼š**
1. **è¿è¡Œä¸»è„šæœ¬ï¼š`start.bat`
2. **é€‰æ‹©â€œ1â€**å®‰è£…ä¾èµ–é¡¹
3. **ç­‰å¾…**è‡ªåŠ¨å®‰è£…å®Œæˆ
4. **åº”ç”¨ç¨‹åºå°†è‡ªåŠ¨å¯åŠ¨**

#### **å¯¹äºå¼€å‘è€…ï¼š**
- **å®Œæ•´å®‰è£…ï¼š**`install_requirements.bat`
- **è¿è¡Œï¼š**`run_gui.bat`
- **è¯Šæ–­ï¼š**`check_system.bat`

è„šæœ¬ç³»ç»Ÿä¼šä¸ºæ‚¨å®Œæˆæ‰€æœ‰æ“ä½œï¼š
- âœ… åœ¨ `.venv` æ–‡ä»¶å¤¹ä¸­åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
- âœ… è‡ªåŠ¨æ¿€æ´»ç¯å¢ƒ
- âœ… ä» `requirements.txt` å®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–é¡¹
- âœ… è‡ªåŠ¨æ£€æµ‹æ‚¨æ˜¯å¦æ‹¥æœ‰ NVIDIA GPU å¹¶æ­£ç¡®å®‰è£… PyTorch
- âœ… å®‰è£…å…·æœ‰é«˜çº§åŠŸèƒ½çš„ Unstructured
- âœ… å¯åŠ¨åº”ç”¨ç¨‹åº

åœ¨åç»­è¿è¡Œä¸­ï¼Œè„šæœ¬å°†ç›´æ¥æ¿€æ´»ç¯å¢ƒå¹¶å¯åŠ¨ç›´æ¥å®‰è£…åº”ç”¨ç¨‹åºã€‚

### 2. æ‰‹åŠ¨å®‰è£…ä¾èµ–é¡¹ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨å¸Œæœ›æ‰‹åŠ¨å®‰è£…ä¾èµ–é¡¹æˆ–éœ€è¦ç‰¹å®šåŠŸèƒ½ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\.venv\Scripts\activate

# å®‰è£… Unstructuredï¼ˆå®Œæ•´èƒ½åŠ›ï¼‰
pip install "unstructured[local-inference,all-docs]"

# ä¸€äº›æ€§èƒ½ç›¸å…³çš„å»ºè®®ä¾èµ–
pip install python-docx openpyxl beautifulsoup4 pytesseract
```

### 3. é…ç½® Ollamaï¼ˆå…³é”®ï¼‰

Ollama æ˜¯ RAG ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ‰€å¿…éœ€çš„ï¼Œå› ä¸ºå®ƒæä¾›äº†ç”Ÿæˆå›ç­”çš„æœ¬åœ°è¯­è¨€æ¨¡å‹ã€‚

#### Ollama å®‰è£…æ­¥éª¤

**Windows:**
1. ä» [ollama.com](https://ollama.com/) ä¸‹è½½ Ollama
2. è¿è¡Œå®‰è£…ç¨‹åºå¹¶æŒ‰ç…§æŒ‡ç¤ºå®Œæˆå®‰è£…
3. Ollama ä¼šè‡ªåŠ¨ä½œä¸ºæœåŠ¡å¯åŠ¨

macOS/Linuxï¼š
```bash
curl -fsSL https://ollama.ai/install.sh | sh
```

#### éªŒè¯å®‰è£…ï¼š

```bash
ollama --version

# éªŒè¯æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
ollama list
```

#### ä¸‹è½½æ¨¡å‹ï¼š

RAG ç³»ç»Ÿéœ€è¦ä¸€ä¸ªè¯­è¨€æ¨¡å‹æ¥ç”Ÿæˆå›ç­”ã€‚æˆ‘ä»¬é€‰æ‹© Ollama æ˜¯å› ä¸ºå®ƒæ˜¯å…è´¹çš„ï¼š

```bash
# æ¨èï¼ˆé€Ÿåº¦ä¸è´¨é‡å‡è¡¡ï¼‰
ollama pull llama3

# æ›´å¿«çš„æ›¿ä»£
ollama pull phi3
ollama pull mistral

# æ›´å¼ºä½†æ›´åƒèµ„æº
ollama pull llama3.1:8b
```

#### åœ¨ç³»ç»Ÿä¸­é…ç½®æ¨¡å‹

æ¨¡å‹ä¸‹è½½å®Œæˆåï¼Œç¡®ä¿ `rag_core.py` ä½¿ç”¨äº†æ­£ç¡®çš„æ¨¡å‹ï¼š


```python
# åœ¨ rag_core.py æ–‡ä»¶å¤§çº¦ç¬¬100è¡Œï¼Œç¡®è®¤ä½¿ç”¨ä½ çš„æ¨¡å‹ï¼š
llm = ChatOllama(model="llama3", temperature=0)
```

**æ³¨æ„ï¼š** å¦‚æœä½ ä¸‹è½½äº†ä¸åŒçš„æ¨¡å‹ï¼Œè¯·å°† `"llama3"` æ”¹æˆä½ æ‰€ä½¿ç”¨æ¨¡å‹çš„åç§°ã€‚

#### æµ‹è¯• Ollama


```bash
# æµ‹è¯•æ¨¡å‹æ˜¯å¦æ­£å¸¸å·¥ä½œ
ollama run llama3 "Hello"
```

å¦‚æœä½ çœ‹åˆ°ç”Ÿæˆçš„å›ç­”ï¼Œè¯´æ˜ Ollama æ­£å¸¸è¿è¡Œã€‚

#### å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

**é”™è¯¯ï¼šâ€œOllama is not runningâ€ï¼ˆOllama æœªè¿è¡Œï¼‰**

```bash
# æ‰‹åŠ¨å¯åŠ¨ Ollama æœåŠ¡
ollama serve
```

**é”™è¯¯ï¼šâ€œModel not foundâ€ï¼ˆæœªæ‰¾åˆ°æ¨¡å‹ï¼‰**

```bash
# æŸ¥çœ‹å¯ç”¨æ¨¡å‹åˆ—è¡¨
ollama list

# å¦‚æœæ¨¡å‹ä¸å­˜åœ¨ï¼Œä¸‹è½½æ¨¡å‹
ollama pull llama3
```

**é”™è¯¯ï¼šâ€œOut of memoryâ€ï¼ˆå†…å­˜ä¸è¶³ï¼‰**

* ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼Œä¾‹å¦‚ï¼š`ollama pull phi3`
* å…³é—­å…¶ä»–å ç”¨å¤§é‡å†…å­˜çš„åº”ç”¨ç¨‹åº
* è€ƒè™‘åœ¨ Windows ç³»ç»Ÿä¸­å¢åŠ è™šæ‹Ÿå†…å­˜å®¹é‡


### 4. ç³»ç»Ÿè‡ªæ£€

åœ¨ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆéªŒè¯ä¸€ä¸‹ä¸€åˆ‡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

#### æ­¥éª¤ 1ï¼šéªŒè¯ Ollama
```bash
# éªŒè¯ Ollama æ˜¯å¦æ­£åœ¨è¿è¡Œ
ollama list

# æµ‹è¯•æ¨¡å‹
ollama run llama3 "Test"
```

#### æ­¥éª¤ 2ï¼šæ£€æŸ¥ Python ä¾èµ–é¡¹
```bash
python -c "import mcp; print('âœ… MCP OK')"
python -c "import langchain; print('âœ… LangChain OK')"
python -c "import chromadb; print('âœ… ChromaDB OK')"
python -c "import unstructured; print('âœ… Unstructured OK')"
```

#### æ­¥éª¤ 3ï¼šæµ‹è¯• RAG ç³»ç»Ÿ
```bash
# è¿è¡Œå¢å¼ºæµ‹è¯•è„šæœ¬
python test_enhanced_rag.py
```

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å°†çœ‹åˆ°ï¼š
- âœ… Ollama æ­£åœ¨å“åº”å‘½ä»¤
- âœ… æ‰€æœ‰ä¾èµ–é¡¹å¯¼å…¥å‡æ— é”™è¯¯
- âœ… RAG ç³»ç»Ÿæ­£åœ¨å¤„ç†æŸ¥è¯¢å¹¶æ˜¾ç¤ºæº

**æ‚¨çš„ RAG ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼** ğŸš€

---

## ğŸ“‹ æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

ç³»ç»Ÿæ”¯æŒ 25+ å¸¸è§æ ¼å¼ï¼Œé’ˆå¯¹æ¯ç±»æœ‰ä¼˜åŒ–çš„å¤„ç†æµç¨‹ï¼š

### ğŸ“„ Office æ–‡æ¡£
- PDFï¼ˆ.pdfï¼‰- é«˜åˆ†è¾¨ç‡å¤„ç†
- Wordï¼ˆ.docx, .docï¼‰
- PowerPointï¼ˆ.pptx, .pptï¼‰
- Excelï¼ˆ.xlsx, .xlsï¼‰
- RTFï¼ˆ.rtfï¼‰

### ğŸ“ OpenDocument æ–‡æ¡£
- ODTï¼ˆ.odtï¼‰
- ODPï¼ˆ.odpï¼‰
- ODSï¼ˆ.odsï¼‰

### ğŸŒ Web/æ ‡è®°è¯­è¨€
- HTMLï¼ˆ.html, .htmï¼‰
- XMLï¼ˆ.xmlï¼‰
- Markdownï¼ˆ.mdï¼‰

### ğŸ“ çº¯æ–‡æœ¬/è¡¨æ ¼
- TXTï¼ˆ.txtï¼‰
- CSVï¼ˆ.csvï¼‰
- TSVï¼ˆ.tsvï¼‰

### ğŸ“Š æ•°æ®æ ¼å¼
- JSONï¼ˆ.jsonï¼‰
- YAMLï¼ˆ.yaml, .ymlï¼‰

### ğŸ–¼ï¸ å›¾ç‰‡ï¼ˆå« OCRï¼‰
- PNGï¼ˆ.pngï¼‰
- JPG/JPEGï¼ˆ.jpg, .jpegï¼‰
- TIFFï¼ˆ.tiffï¼‰
- BMPï¼ˆ.bmpï¼‰

### ğŸ“§ é‚®ä»¶
- EMLï¼ˆ.emlï¼‰
- MSGï¼ˆ.msgï¼‰

---

## ğŸ› ï¸ ç”¨æˆ·æŒ‡å—

### æ–¹å¼ 1ï¼šä½¿ç”¨ GUI å¡«å……çŸ¥è¯†åº“ï¼ˆæ¨èï¼‰

æ·»åŠ æ–‡æ¡£æœ€ç®€å•ã€æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯ä½¿ç”¨å›¾å½¢ç•Œé¢ã€‚

1. **è¿è¡Œä¸»è„šæœ¬ï¼š** `start.bat`
2. **é€‰æ‹©â€œ1â€**è¿è¡Œåº”ç”¨ç¨‹åº
3. **åº”ç”¨ç¨‹åºå°†å¯åŠ¨**ï¼ˆå®‰è£…ä¾èµ–é¡¹å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼‰
4. **ä½¿ç”¨â€œæµè§ˆ...â€æŒ‰é’®**é€‰æ‹©åŒ…å«æ–‡æ¡£çš„æ–‡ä»¶å¤¹
5. **ç‚¹å‡»â€œå¼€å§‹å¤„ç†â€**ã€‚æ–‡ä»¶å°†ä½¿ç”¨ Unstructured çš„é«˜çº§ç³»ç»Ÿè¿›è¡Œå¤„ç†ã€‚
6. **è½¬åˆ°â€œå®¡é˜…â€é€‰é¡¹å¡**ï¼Œé€‰æ‹©è¦ä¿å­˜çš„æ–‡ä»¶å¹¶é¢„è§ˆå…¶å†…å®¹ã€‚
7. **è½¬åˆ°â€œå­˜å‚¨â€é€‰é¡¹å¡**ï¼Œç„¶åç‚¹å‡»â€œå¼€å§‹ä¿å­˜â€ï¼Œå°†é€‰å®šçš„æ–‡æ¡£ä¿å­˜åˆ°æ•°æ®åº“ã€‚

#### âœ¨ **å¸¦æœ‰é¢„è§ˆå’Œé€‰æ‹©åŠŸèƒ½çš„æ‰¹é‡æ–‡æ¡£æå– GUI**

ä¸ºäº†å…¨é¢æŒæ§æå–è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª **GUI**ã€‚æ­¤ç‰ˆæœ¬å…è®¸æ‚¨ **é¢„è§ˆ** æ¯ä¸ªå·²å¤„ç†æ–‡æ¡£çš„å†…å®¹ï¼Œå¹¶ **æ‰‹åŠ¨é€‰æ‹©** æ‚¨æƒ³è¦æ·»åŠ åˆ°çŸ¥è¯†åº“çš„æ–‡æ¡£ã€‚

**GUI åŠŸèƒ½ï¼š**
- **æ™ºèƒ½å¤„ç†ï¼š**ä½¿ç”¨éç»“æ„åŒ–æ•°æ®å»é™¤å™ªéŸ³å¹¶ä¿ç•™ç»“æ„
- **å®æ—¶é¢„è§ˆï¼š**ä¿å­˜å‰æŸ¥çœ‹å·²å¤„ç†å†…å®¹
- **ç²¾ç»†é€‰æ‹©ï¼š**å•ç‹¬æ ‡è®°/å–æ¶ˆæ ‡è®°æ–‡æ¡£
- **ç»“æ„åŒ–å…ƒæ•°æ®ï¼š**æ¯ä¸ªæ–‡æ¡£çš„æ ‡é¢˜ã€è¡¨æ ¼å’Œåˆ—è¡¨ä¿¡æ¯
- **åå¤‡ç³»ç»Ÿï¼š**å¤šç§ç­–ç•¥ç¡®ä¿æ¯ä¸ªæ–‡æ¡£éƒ½å¾—åˆ°å¤„ç†
- **è¿›åº¦ç³»ç»Ÿï¼š**è¯¦ç»†è·Ÿè¸ªä¿å­˜è¿‡ç¨‹

![GUI å¤„ç†é€‰é¡¹å¡](src/images/gui_processing.png)

â¡ï¸ **æœ‰å…³å¦‚ä½•ä½¿ç”¨å®ƒçš„å®Œæ•´æŒ‡å—ï¼Œè¯·å‚é˜…[æ‰¹é‡ä¸Šä¼ æŒ‡å—](./GUI_ADVANCED_README.md)ã€‚**

### æ–¹å¼ 2ï¼šä»å‘½ä»¤è¡Œå¡«å……çŸ¥è¯†åº“

å¦‚æœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨å‘½ä»¤è¡Œæˆ–éœ€è¦è‡ªåŠ¨æå–æ•°æ®ã€‚
1. **æ‰“å¼€ç»ˆç«¯**
2. **æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š**
3. **è¿è¡Œè„šæœ¬**
```bash
.\.venv\Scripts\activate
python bulk_ingest.py --directory "C:\\Path\\To\\Docs"
```

**å¢å¼ºçš„å¤„ç†åŠŸèƒ½**
- **è‡ªåŠ¨æ ¼å¼æ£€æµ‹**ï¼šç³»ç»Ÿæ ¹æ®æ–‡ä»¶ç±»å‹è¯†åˆ«å¹¶ä¼˜åŒ–å¤„ç†
- **æ™ºèƒ½æ¸…ç†**ï¼šè‡ªåŠ¨åˆ é™¤é¡µçœ‰ã€é¡µè„šå’Œä¸ç›¸å…³å†…å®¹
- **ç»“æ„ä¿å­˜**ï¼šä¿æŒæ ‡é¢˜ã€åˆ—è¡¨å’Œè¡¨æ ¼äº•ç„¶æœ‰åº
- **ä¸°å¯Œçš„å…ƒæ•°æ®**ï¼šæä¾›æ¯ä¸ªæ–‡æ¡£ç»“æ„çš„è¯¦ç»†ä¿¡æ¯
- **è¯¦ç»†æ—¥å¿—**ï¼šæä¾›æ¯ä¸ªæ–‡ä»¶å¤„ç†çš„å®Œæ•´ä¿¡æ¯

### æ–¹å¼ 3ï¼šé…ç½® MCP å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Cursorï¼‰

ä¸ºäº†è®©ä½ çš„ AI ç¼–è¾‘å™¨ä½¿ç”¨æœåŠ¡å™¨ï¼Œä½ å¿…é¡»å¯¹å…¶è¿›è¡Œé…ç½®ã€‚

1. **æ‰¾åˆ°ä½ ç¼–è¾‘å™¨çš„ MCP æœåŠ¡å™¨é…ç½®æ–‡ä»¶ã€‚** å¯¹äº Cursorï¼Œè¯·åœ¨å…¶é…ç½®ç›®å½•ï¼ˆWindows ä¸Šä¸ºâ€œ%APPDATA%\cursorâ€ï¼‰ä¸­æŸ¥æ‰¾ç±»ä¼¼â€œmcp_servers.jsonâ€çš„æ–‡ä»¶ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½ å¯ä»¥åˆ›å»ºå®ƒã€‚
2. **å°†ä»¥ä¸‹é…ç½®æ·»åŠ åˆ° JSON æ–‡ä»¶ã€‚**

æ­¤æ–¹æ³•ä½¿ç”¨ MCP æœåŠ¡å™¨è„šæœ¬ (`run_server_organized.bat`) æ¥è¿è¡Œ RAG æœåŠ¡å™¨ã€‚

**é‡è¦æç¤ºï¼** æ‚¨å¿…é¡»å°†â€œD:\full\path\to\your\MCP_RAG\projectâ€æ›¿æ¢ä¸ºæ‚¨è®¡ç®—æœºä¸Šè¯¥é¡¹ç›®æ–‡ä»¶å¤¹çš„å®é™…ç»å¯¹è·¯å¾„ã€‚

```json
{
    "mcpServers": {
        "rag": {
            "command": "D:\\your\\absolute\\path\\MCP_RAG\\mcp_server_organized\\run_server_organized.bat",
            "args": [],
            "workingDirectory": "D:\\your\\absolute\\path\\MCP_RAG"
        }
    }
}
```

3. **é‡å¯ç¼–è¾‘å™¨ã€‚** å¯åŠ¨åï¼Œç¼–è¾‘å™¨ä¼šæ£€æµ‹å¹¶å¯åŠ¨ MCP æœåŠ¡å™¨ï¼Œè¿™å°†æ˜¾ç¤º RAG å·¥å…·ä»¥ä¾›èŠå¤©ä½¿ç”¨ã€‚

### æ–¹å¼å››ï¼šåœ¨èŠå¤©ä¸­ç›´æ¥è°ƒç”¨å·¥å…·

é…ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨ç¼–è¾‘å™¨èŠå¤©ä¸­ä½¿ç”¨è¿™äº›å·¥å…·ã€‚

### å¯ç”¨å·¥å…·ï¼š



**1. `learn_text(text, source_name)` - æ·»åŠ æ–‡æœ¬ä¿¡æ¯**
```
@rag learn_text("é’›çš„ç†”ç‚¹ä¸º 1.668 Â°Cã€‚", "material_properties")
```
- **ä½¿ç”¨åœºæ™¯**ï¼šæ·»åŠ äº‹å®ã€å®šä¹‰ã€è®¨è®ºæ³¨é‡Šç­‰ã€‚
- **å‚æ•°**ï¼š
- `text`ï¼šè¦å­˜å‚¨çš„å†…å®¹
- `source_name`ï¼šæºçš„æè¿°æ€§åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ºâ€œmanual_inputâ€ï¼‰
**2. `learn_document(file_path)` - å¤„ç†æ–‡æ¡£**
```
@rag learn_document("C:\\Reports\\q3.pdf")
```

- **é€‚ç”¨åœºæ™¯**ï¼šå¤„ç† PDFã€DOCXã€PPTXã€XLSXã€TXTã€HTMLã€CSVã€JSONã€XMLã€å›¾ç‰‡ã€ç”µå­é‚®ä»¶ä»¥åŠè¶…è¿‡ 25 ç§å…¶ä»–æ ¼å¼
- **å¢å¼ºåŠŸèƒ½**ï¼š
- **æ™ºèƒ½å¤„ç†**ï¼šä½¿ç”¨éç»“æ„åŒ–æ•°æ®å»é™¤å™ªéŸ³å¹¶ä¿ç•™ç»“æ„
- **åå¤‡ç³»ç»Ÿ**ï¼šå¤šç§ç­–ç•¥ç¡®ä¿å¤„ç†æˆåŠŸ
- **ç»“æ„åŒ–å…ƒæ•°æ®**ï¼šæ ‡é¢˜ã€è¡¨æ ¼å’Œåˆ—è¡¨çš„è¯¦ç»†ä¿¡æ¯
- **è‡ªåŠ¨è½¬æ¢**ï¼šæ ¹æ®æ–‡ä»¶ç±»å‹ä¼˜åŒ–å¤„ç†
- **å·²ä¿å­˜å‰¯æœ¬**ï¼šå¤„ç†åçš„æ–‡æ¡£ä¿å­˜åœ¨ `./converted_docs/` ä¸­

**3. `ask_rag(query)` - æŸ¥è¯¢ä¿¡æ¯**
```
@rag ask_rag("é’›çš„ç†”ç‚¹æ˜¯å¤šå°‘ï¼Ÿ")
```
- **ä½¿ç”¨åœºæ™¯**ï¼šæœç´¢å…ˆå‰å­˜å‚¨çš„ä¿¡æ¯
- **ç­”æ¡ˆåŒ…å«**ï¼š
- AI ç”Ÿæˆçš„ç­”æ¡ˆï¼Œå¹¶å¢å¼ºäº†ä¸Šä¸‹æ–‡
- ğŸ“š åŒ…å«ç»“æ„åŒ–å…ƒæ•°æ®çš„æ¥æºåˆ—è¡¨
- æ¯ä¸ªæ¥æºçš„ç›¸å…³æ€§ä¿¡æ¯

**4. `ask_rag_filtered(query, file_type, min_tables, min_titles, processing_method)` - ä½¿ç”¨è¿‡æ»¤å™¨æœç´¢**
```
@rag ask_rag_filtered("æˆ‘ä»¬æœ‰å“ªäº›æ•°æ®è¡¨ï¼Ÿ", file_type=".pdf", min_tables=1)
```
- **ä½•æ—¶ä½¿ç”¨**ï¼šä½¿ç”¨å…ƒæ•°æ®è¿‡æ»¤å™¨è¿›è¡Œæ›´ç²¾ç¡®çš„æœç´¢
- **å¯ç”¨çš„è¿‡æ»¤å™¨**ï¼š
- `file_type`ï¼šæ–‡ä»¶ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œ".pdf"ã€".docx"ã€".xlsx"ï¼‰
- `min_tables`ï¼šæ–‡æ¡£ä¸­è¡¨æ ¼çš„æœ€å°æ•°é‡
- `min_titles`ï¼šæ–‡æ¡£ä¸­æ ‡é¢˜çš„æœ€å°æ•°é‡
- `processing_method`ï¼šä½¿ç”¨çš„å¤„ç†æ–¹æ³•
- **ä¼˜ç‚¹**ï¼šæœç´¢æ›´ç›¸å…³ã€æ›´å…·ä½“

**5. `get_knowledge_base_stats()` - çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯**
```
@rag get_knowledge_base_stats()
```
- **ä½¿ç”¨åœºæ™¯**ï¼šè·å–å­˜å‚¨å†…å®¹ä¿¡æ¯
- **æä¾›çš„ä¿¡æ¯**ï¼š
- æ–‡æ¡£æ€»æ•°
- æŒ‰æ–‡ä»¶ç±»å‹åˆ†å¸ƒ
- ç»“æ„ç»Ÿè®¡ä¿¡æ¯ï¼ˆè¡¨æ ¼ã€æ ‡é¢˜ã€åˆ—è¡¨ï¼‰
- ä½¿ç”¨çš„å¤„ç†æ–¹æ³•

#### å®Œæ•´æµç¨‹ç¤ºä¾‹ï¼š
```bash
@rag learn_text("é’›çš„ç†”ç‚¹æ˜¯ 1,668Â°Cã€‚", "material_properties")
@rag learn_document("C:\\Documents\\manual_titanium.pdf")
@rag ask_rag("é’›çš„ç†”ç‚¹æ˜¯å¤šå°‘ï¼Ÿ")
@rag ask_rag_filtered("æˆ‘ä»¬æœ‰å“ªäº›è¡¨æ ¼æ•°æ®ï¼Ÿ", min_tables=1)
@rag get_knowledge_base_stats()
```

**é¢„æœŸå›ç­”ï¼š**

```
é’›çš„ç†”ç‚¹æ˜¯ 1668Â°Cã€‚

ğŸ“š ä¿¡æ¯æ¥æºï¼š  
   1. material_propertiesï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰  
   2. manual_titanio.pdfï¼ˆç¬¬3é¡µï¼Œâ€œç‰©ç†æ€§èƒ½â€ç« èŠ‚ï¼‰

ğŸ“Š è¿‡æ»¤åæœç´¢ç»Ÿè®¡ï¼š  
   â€¢ å‘ç°åŒ…å«è¡¨æ ¼çš„æ–‡æ¡£æ•°é‡ï¼š3  
   â€¢ æ–‡ä»¶ç±»å‹ï¼šPDFï¼ˆ2ä»½ï¼‰ã€DOCXï¼ˆ1ä»½ï¼‰  
   â€¢ è¡¨æ ¼æ€»æ•°ï¼š7  
```

---

## ğŸ§ª æµ‹è¯•ä¸éªŒè¯

### æµ‹è¯•ç³»ç»Ÿ

éªŒè¯ä¸€åˆ‡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

```bash
# è¯•ç”¨å¢å¼ºå‹ RAG ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½
python test_enhanced_rag.py
```

#### **æ”¹è¿›çš„æµ‹è¯•è„šæœ¬ (`test_enhanced_rag.py`)**

è¯¥æµ‹è¯•è„šæœ¬éªŒè¯äº†æ‰€æœ‰å·²å®æ–½çš„æ”¹è¿›ï¼š

**ğŸ§ª åŒ…å«çš„æµ‹è¯•ï¼š**
- **æ”¹è¿›çš„æ–‡æ¡£å¤„ç†**ï¼šä½¿ç”¨ç»“æ„åŒ–å…ƒæ•°æ®éªŒè¯éç»“æ„åŒ–ç³»ç»Ÿ
- **æ”¹è¿›çš„çŸ¥è¯†åº“**ï¼šæµ‹è¯•æ”¹è¿›çš„åˆ†å—å’Œä¸°å¯Œçš„å…ƒæ•°æ®
- **MCP æœåŠ¡å™¨é›†æˆ**ï¼šéªŒè¯æ”¹è¿›çš„æœåŠ¡å™¨å·¥å…·
- **æ ¼å¼æ”¯æŒ**ï¼šç¡®è®¤è¶…è¿‡ 25 ç§æ ¼å¼çš„é…ç½®

**ğŸ“Š è¾“å‡ºä¿¡æ¯ï¼š**
- æ¯ä¸ªæµ‹è¯•çš„çŠ¶æ€ï¼ˆâœ… é€šè¿‡ / âŒ å¤±è´¥ï¼‰
- æå–çš„ç»“æ„åŒ–å…ƒæ•°æ®
- ä½¿ç”¨çš„å¤„ç†æ–¹æ³•
- æºå’Œåˆ†å—ä¿¡æ¯
- å®Œæ•´çš„ç³»ç»Ÿæ‘˜è¦

### éªŒè¯æ•°æ®åº“
å­˜å‚¨ä½ç½®ï¼š
- å‘é‡æ•°æ®åº“ï¼š`./rag_mcp_db/`
- è½¬æ¢å‰¯æœ¬ï¼š`./converted_docs/`ï¼ˆè®°å½•å¤„ç†æ–¹æ³•ï¼‰

---

## ğŸ¤– AI ä»£ç†ä½¿ç”¨

è¯¥ç³»ç»Ÿé’ˆå¯¹ AI ä»£ç†è¿›è¡Œäº†ä¼˜åŒ–ã€‚è¯·å‚é˜… [`AGENT_INSTRUCTIONS.md`](./AGENT_INSTRUCTIONS.md) äº†è§£ä»¥ä¸‹å†…å®¹ï¼š

- è¯¦ç»†ä½¿ç”¨æŒ‡å—
- ç”¨ä¾‹ç¤ºä¾‹
- æœ€ä½³å®è·µ
- é”™è¯¯å¤„ç†
- é‡è¦æ³¨æ„äº‹é¡¹

### ä»£ç†åŠŸèƒ½ï¼š

- **æ¯ä¸ªå·¥å…·çš„è¯¦ç»†æè¿°**
- **æ¸…æ™°å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹**
- **æ™ºèƒ½é”™è¯¯å¤„ç†**å¹¶æä¾›å®ç”¨å»ºè®®
- **æºå…ƒæ•°æ®**ï¼Œå®ç°å…¨é¢å¯è¿½æº¯æ€§
- **ç»“æ„åŒ–å“åº”**ï¼ŒåŒ…å«æºä¿¡æ¯

--

## ğŸ”§ å·²å®æ–½çš„æŠ€æœ¯å¢å¼º

æœ¬èŠ‚ä»‹ç»äº†å°†ç³»ç»Ÿè½¬å˜ä¸ºä¼ä¸šçº§è§£å†³æ–¹æ¡ˆçš„é«˜çº§æŠ€æœ¯å¢å¼ºåŠŸèƒ½ã€‚

### **A. ä½¿ç”¨éç»“æ„åŒ–æ•°æ®è¿›è¡Œæ™ºèƒ½å¤„ç†**

Unstructured æ˜¯ä¸€ä¸ªæ–‡æ¡£å¤„ç†åº“ï¼Œå®ƒçš„åŠŸèƒ½è¿œä¸æ­¢ç®€å•çš„æ–‡æœ¬æå–ã€‚å®ƒèƒ½å¤Ÿåˆ†ææ–‡æ¡£çš„è¯­ä¹‰ç»“æ„ï¼Œä»è€Œï¼š

- è¯†åˆ«å…ƒç´ ï¼šæ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€è¡¨æ ¼
- å»é™¤å™ªéŸ³ï¼šç§»é™¤é¡µçœ‰ã€é¡µè„šå’Œä¸ç›¸å…³çš„å…ƒç´ 
- ä¿ç•™ä¸Šä¸‹æ–‡ï¼šç»´æŠ¤æ–‡æ¡£çš„å±‚æ¬¡ç»“æ„å’Œç»“æ„
- å¤„ç†å¤æ‚æ ¼å¼ï¼šæ‰«æçš„ PDFã€åŒ…å«è¡¨æ ¼çš„æ–‡æ¡£ç­‰ã€‚

#### **æŒ‰æ–‡ä»¶ç±»å‹ä¼˜åŒ–é…ç½®ï¼š**

```python
UNSTRUCTURED_CONFIGS = {
    '.pdf': {
        'strategy': 'hi_res',        # Alta resoluciÃ³n para PDFs complejos
        'include_metadata': True,    # Incluir metadatos estructurales
        'include_page_breaks': True, # Preservar saltos de pÃ¡gina
        'max_partition': 2000,       # TamaÃ±o mÃ¡ximo de particiÃ³n
        'new_after_n_chars': 1500    # Nuevo elemento despuÃ©s de N caracteres
    },
    '.docx': {
        'strategy': 'fast',          # Procesamiento rÃ¡pido para documentos de Office
        'include_metadata': True,
        'max_partition': 2000,
        'new_after_n_chars': 1500
    },
    # ... configuraciones para mÃ¡s de 25 formatos
}
```

#### **æ™ºèƒ½å…ƒç´ å¤„ç†ï¼š**

```python
def process_unstructured_elements(elements: List[Any]) -> str:
    """Procesa elementos de Unstructured preservando estructura semÃ¡ntica."""
    for element in elements:
        element_type = type(element).__name__
        
        if element_type == 'Title':
            # Los tÃ­tulos van con formato especial
            processed_parts.append(f"\n## {element.text.strip()}\n")
        elif element_type == 'ListItem':
            # Las listas mantienen su estructura
            processed_parts.append(f"â€¢ {element.text.strip()}")
        elif element_type == 'Table':
            # Las tablas se convierten a texto legible
            table_text = convert_table_to_text(element)
            processed_parts.append(f"\n{table_text}\n")
        elif element_type == 'NarrativeText':
            # El texto narrativo va tal como estÃ¡
            processed_parts.append(element.text.strip())
```

### **B. å¼ºå¤§çš„å›é€€ç³»ç»Ÿ**

#### **çº§è”å›é€€ç­–ç•¥ï¼š**

ç³»ç»Ÿä¼šæŒ‰ä¼˜å…ˆé¡ºåºå°è¯•å¤šç§ç­–ç•¥ï¼š

1. **éç»“æ„åŒ–ï¼Œé‡‡ç”¨æœ€ä½³é…ç½®**
- ä½¿ç”¨ç‰¹å®šæ–‡ä»¶ç±»å‹çš„è®¾ç½®
- æœ€é«˜å¤„ç†è´¨é‡

2. **éç»“æ„åŒ–ï¼Œé‡‡ç”¨åŸºæœ¬é…ç½®**
- â€œå¿«é€Ÿâ€ç­–ç•¥ï¼Œç¡®ä¿å…¼å®¹æ€§
- æ›´ç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„å¤„ç†

3. **è¯­è¨€é“¾ä¸“ç”¨åŠ è½½å™¨**
- æ¯ç§æ–‡ä»¶ç±»å‹ä½¿ç”¨ä¸“ç”¨åŠ è½½å™¨
- é’ˆå¯¹æœ‰é—®é¢˜æ ¼å¼çš„æœ€åè§£å†³æ–¹æ¡ˆ

#### **å›é€€ç¤ºä¾‹ï¼š**

```python
def load_document_with_fallbacks(file_path: str) -> tuple[str, dict]:
    file_extension = os.path.splitext(file_path)[1].lower()
    
    # Estrategia 1: Unstructured Ã³ptimo
    try:
        config = UNSTRUCTURED_CONFIGS.get(file_extension, DEFAULT_CONFIG)
        elements = partition(filename=file_path, **config)
        processed_text = process_unstructured_elements(elements)
        metadata = extract_structural_metadata(elements, file_path)
        return processed_text, metadata
    except Exception as e:
        log(f"Core Warning: Unstructured Ã³ptimo fallÃ³: {e}")
    
    # Estrategia 2: Unstructured bÃ¡sico
    try:
        elements = partition(filename=file_path, strategy="fast")
        # ... procesamiento
    except Exception as e:
        log(f"Core Warning: Unstructured bÃ¡sico fallÃ³: {e}")
    
    # Estrategia 3: LangChain fallbacks
    try:
        fallback_text = load_with_langchain_fallbacks(file_path)
        # ... procesamiento
    except Exception as e:
        log(f"Core Warning: LangChain fallbacks fallaron: {e}")
    
    return "", {}  # Solo si todas las estrategias fallan
```

### **C. ä¸°å¯Œçš„ç»“æ„å…ƒæ•°æ®**

#### **æ•è·çš„ç»“æ„ä¿¡æ¯ï¼š**

```python
def extract_structural_metadata(elements: List[Any], file_path: str) -> Dict[str, Any]:
    structural_info = {
        "total_elements": len(elements),
        "titles_count": sum(1 for e in elements if type(e).__name__ == 'Title'),
        "tables_count": sum(1 for e in elements if type(e).__name__ == 'Table'),
        "lists_count": sum(1 for e in elements if type(e).__name__ == 'ListItem'),
        "narrative_blocks": sum(1 for e in elements if type(e).__name__ == 'NarrativeText'),
        "total_text_length": total_text_length,
        "avg_element_length": total_text_length / len(elements) if elements else 0
    }
    
metadata = {
        "source": os.path.basename(file_path),
        "file_path": file_path,
        "file_type": os.path.splitext(file_path)[1].lower(),
        "processed_date": datetime.now().isoformat(),
        "processing_method": "unstructured_enhanced",
        "structural_info": structural_info
    }
```

#### **ç»“æ„åŒ–å…ƒæ•°æ®çš„ä¼˜åŠ¿ï¼š**

- **å¯è¿½æº¯æ€§**ï¼šæ‚¨å¯ä»¥å‡†ç¡®äº†è§£æ–‡æ¡£çš„å“ªä¸ªéƒ¨åˆ†è¢«ä½¿ç”¨
- **è´¨é‡**ï¼šå†…å®¹ç»“æ„ä¿¡æ¯
- **ä¼˜åŒ–**ï¼šç”¨äºæ”¹è¿›åç»­å¤„ç†çš„æ•°æ®
- **è°ƒè¯•**ï¼šç”¨äºè§£å†³é—®é¢˜çš„è¯¦ç»†ä¿¡æ¯

### **D. æ”¹è¿›çš„æ™ºèƒ½æ–‡æœ¬æ–­å­—åŠŸèƒ½**

#### **ä¼˜åŒ–é…ç½®ï¼š**

```python
text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=1000,        # TamaÃ±o mÃ¡ximo de cada fragmento
    chunk_overlap=200,      # Caracteres que se comparten entre fragmentos
    length_function=len,    # FunciÃ³n para medir longitud
    separators=["\n\n", "\n", ". ", "! ", "? ", " ", ""]  # Separadores inteligentes
)
```

#### **æ™ºèƒ½åˆ†éš”ç¬¦ï¼š**

ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾æœ€ä½³æ–­ç‚¹ï¼š
1. **`\n\n`** - æ®µè½ï¼ˆæœ€ä½³é€‰æ‹©ï¼‰
2. **`\n`** - æ¢è¡Œç¬¦
3. **`. `** - å¥å°¾
4. **`! `** - æ„Ÿå¹å·ç»“å°¾
5. **`? `** - ç–‘é—®å¥ç»“å°¾
6. **` `** - ç©ºæ ¼ï¼ˆæœ€åé€‰æ‹©ï¼‰

### **E. æœç´¢å¼•æ“ä¼˜åŒ–**

#### **å½“å‰é…ç½®ï¼š**

```python
retriever = vector_store.as_retriever(
    search_type="similarity_score_threshold",  # BÃºsqueda con umbral de similitud
search_kwargs={
        "k": 5,                # Recupera 5 fragmentos mÃ¡s relevantes
        "score_threshold": 0.3, # Umbral de distancia (similitud > 0.7)
    }
)
```

#### **ä¼˜åŒ–å‚æ•°ï¼š**

- **`k=5`**ï¼šä» 5 ä¸ªä¸åŒæ¥æºè·å–ä¿¡æ¯ï¼Œä»¥è·å¾—æ›´å®Œæ•´çš„ç­”æ¡ˆ
- **`score_threshold=0.3`**ï¼šç¡®ä¿ä»…ä½¿ç”¨é«˜åº¦ç›¸å…³çš„ä¿¡æ¯ï¼ˆç›¸ä¼¼åº¦ > 70%ï¼‰
- **ç›¸ä¼¼åº¦æœç´¢**ï¼šæŸ¥æ‰¾è¯­ä¹‰ä¸Šæœ€ç›¸ä¼¼çš„å†…å®¹

### **F. è‡ªåŠ¨æ–‡æœ¬æ¸…ç†**

#### **æ¸…ç†è¿‡ç¨‹ï¼š**

```python
def clean_text_for_rag(text: str) -> str:
    """Limpia y prepara el texto para mejorar la calidad de las bÃºsquedas RAG."""
    if not text:
        return ""
    
    # Eliminar espacios mÃºltiples y saltos de lÃ­nea excesivos
    text = re.sub(r'\s+', ' ', text)
    
    # Eliminar caracteres especiales problemÃ¡ticos pero mantener puntuaciÃ³n importante
    text = re.sub(r'[^\w\s\.\,\!\?\;\:\-\(\)\[\]\{\}\"\']', '', text)
    
    # Normalizar espacios alrededor de puntuaciÃ³n
    text = re.sub(r'\s+([\.\,\!\?\;\:])', r'\1', text)
    
    # Eliminar lÃ­neas vacÃ­as mÃºltiples
    text = re.sub(r'\n\s*\n', '\n\n', text)
    
    # Limpiar espacios al inicio y final
    text = text.strip()
    
    return text
```

### **G. é«˜çº§å…ƒæ•°æ®è¿‡æ»¤ç³»ç»Ÿ**

#### **è¿‡æ»¤åŠŸèƒ½ï¼š**

ç³»ç»Ÿç°å·²åŒ…å«é«˜çº§è¿‡æ»¤åŠŸèƒ½ï¼Œå¯å®ç°æ›´ç²¾ç¡®ã€æ›´ç›¸å…³çš„æœç´¢ï¼š

```python
def create_metadata_filter(file_type: str = None, processing_method: str = None,
                          min_tables: int = None, min_titles: int = None,
                          source_contains: str = None) -> dict:
    """Crea filtros de metadatos para bÃºsquedas mÃ¡s precisas."""
    filters = []
    
    if file_type:
        filters.append({"file_type": file_type})
    if processing_method:
        filters.append({"processing_method": processing_method})
    if min_tables:
        filters.append({"structural_info_tables_count": {"$gte": min_tables}})
    if min_titles:
        filters.append({"structural_info_titles_count": {"$gte": min_titles}})
    if source_contains:
        filters.append({"source": {"$contains": source_contains}})
    
    return {"$and": filters} if len(filters) > 1 else filters[0] if filters else None
```

#### **ä½¿ç”¨è¿‡æ»¤å™¨æœç´¢ï¼š**

```python
def search_with_metadata_filters(vector_store: Chroma, query: str, 
                                metadata_filter: dict = None, k: int = 5) -> List[Any]:
    """Realiza bÃºsquedas con filtros de metadatos para mayor precisiÃ³n."""
    if metadata_filter:
        # BÃºsqueda con filtros especÃ­ficos
        results = vector_store.similarity_search_with_relevance_scores(
            query, k=k, filter=metadata_filter
        )
    else:
        # BÃºsqueda normal sin filtros
        results = vector_store.similarity_search_with_relevance_scores(query, k=k)
    
    return results
```

#### **çŸ¥è¯†åº“ç»Ÿè®¡ï¼š**

```python
def get_document_statistics(vector_store: Chroma) -> dict:
    """Obtiene estadÃ­sticas detalladas sobre la base de conocimientos."""
    all_docs = vector_store.get()
    
    if not all_docs or not all_docs.get('metadatas'):
        return {"total_documents": 0}
    
    metadatas = all_docs['metadatas']
    
    # AnÃ¡lisis por tipo de archivo
    file_types = {}
    processing_methods = {}
    total_tables = 0
    total_titles = 0
    
    for metadata in metadatas:
        file_type = metadata.get("file_type", "unknown")
        processing_method = metadata.get("processing_method", "unknown")
        tables_count = metadata.get("structural_info_tables_count", 0)
        titles_count = metadata.get("structural_info_titles_count", 0)
        
        file_types[file_type] = file_types.get(file_type, 0) + 1
        processing_methods[processing_method] = processing_methods.get(processing_method, 0) + 1
        total_tables += tables_count
        total_titles += titles_count
    
    return {
        "total_documents": len(metadatas),
        "file_types": file_types,
        "processing_methods": processing_methods,
        "total_tables": total_tables,
        "total_titles": total_titles,
        "avg_tables_per_doc": total_tables / len(metadatas) if metadatas else 0,
        "avg_titles_per_doc": total_titles / len(metadatas) if metadatas else 0
    }
```

#### **è¿‡æ»¤ç”¨ä¾‹ï¼š**

1) æŒ‰æ–‡ä»¶ç±»å‹è¿‡æ»¤ PDFï¼š
```python
pdf_filter = create_metadata_filter(file_type=".pdf")
results = search_with_metadata_filters(vector_store, "datos", pdf_filter)
```

2) ä»…å«è¡¨æ ¼çš„æ–‡æ¡£ï¼š
```python
tables_filter = create_metadata_filter(min_tables=1)
results = search_with_metadata_filters(vector_store, "datos tabulares", tables_filter)
```

3) æŒ‰å¤„ç†æ–¹æ³•è¿‡æ»¤ï¼ˆä»… Unstructured å¢å¼ºï¼‰ï¼š
```python
unstructured_filter = create_metadata_filter(processing_method="unstructured_enhanced")
results = search_with_metadata_filters(vector_store, "contenido", unstructured_filter)
```

4) ç»„åˆè¿‡æ»¤ï¼š
```python
complex_filter = create_metadata_filter(file_type=".pdf", min_tables=1, processing_method="unstructured_enhanced")
results = search_with_metadata_filters(vector_store, "datos", complex_filter)
```

### **H. å¢å¼ºå‹ MCP å·¥å…·**

#### **æ–°å¢å·¥å…·ï¼š**

1. **`ask_rag_filtered`**ï¼šä½¿ç”¨å…ƒæ•°æ®è¿‡æ»¤å™¨è¿›è¡Œæœç´¢
2. **`get_knowledge_base_stats`**ï¼šè¯¦ç»†çš„çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯

#### **ä¸ AI ä»£ç†é›†æˆï¼š**

æ–°å·¥å…·é’ˆå¯¹ AI ä»£ç†è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
- **å‚æ•°å’Œç”¨ä¾‹çš„è¯¦ç»†æè¿°**
- **æ¯ä¸ªå·¥å…·çš„å…·ä½“ç¤ºä¾‹**
- **æ™ºèƒ½é”™è¯¯å¤„ç†**å¹¶æä¾›å®ç”¨å»ºè®®
- **ç»“æ„åŒ–å“åº”**å¹¶æä¾›å…ƒæ•°æ®ä¿¡æ¯

---
